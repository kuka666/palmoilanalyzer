import os
from openai import OpenAI
from dotenv import load_dotenv

load_dotenv()
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")

client = OpenAI(api_key=OPENAI_API_KEY)

def analyze_news(news_item):
    date = news_item["date"]
    title = news_item["title"]
    source = news_item["source"]
    link = news_item.get("link", "")

    news_text = f"{title}\n–ò—Å—Ç–æ—á–Ω–∏–∫: {source}\n–î–∞—Ç–∞: {date}\n–°—Å—ã–ª–∫–∞: {link}"

    prompt = f"""
–¢—ã ‚Äî –≤–µ–¥—É—â–∏–π –∞–Ω–∞–ª–∏—Ç–∏–∫ –º–∏—Ä–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è –ø–æ —Ä—ã–Ω–∫—É Palm Oil.  
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–Ω—ã–µ –ª–µ–Ω—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å:
‚Ä¢ Palm Oil, —Å–µ–ª—å—Å–∫–∏–º —Ö–æ–∑—è–π—Å—Ç–≤–æ–º, –ø–æ–≥–æ–¥–æ–π, –≥–µ–æ–ø–æ–ª–∏—Ç–∏–∫–æ–π, –ª–æ–≥–∏—Å—Ç–∏–∫–æ–π, —Ç–æ—Ä–≥–æ–≤—ã–º–∏ –±–∞—Ä—å–µ—Ä–∞–º–∏, –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –∏ –º–∞–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏–∫–æ–π.

üîç –î–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É–π —ç—Ç–∏–º —à–∞–≥–∞–º:

1. üìå –ö—Ä–∞—Ç–∫–∞—è –≤—ã–∂–∏–º–∫–∞ (Bullet Points):
‚Ä¢ –£–∫–∞–∂–∏ –¥–æ 5 –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –º–æ–≥—É—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ —Ü–µ–Ω—É –∏–ª–∏ –ª–æ–≥–∏—Å—Ç–∏–∫—É Palm Oil.
‚Ä¢ –£–∫–∞–∑—ã–≤–∞–π –¥–∞—Ç—É –∏ üîó —Å—Å—ã–ª–∫—É —Ç–æ–ª—å–∫–æ –∏–∑ –Ω–æ–≤–æ—Å—Ç–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —è –¥–∞–ª –Ω–∏–∂–µ.

2. üìä –ê–Ω–∞–ª–∏–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ä—ã–Ω–æ–∫:
‚Ä¢ –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–π –≤–ª–∏—è–Ω–∏–µ: —Ä–æ—Å—Ç / –ø–∞–¥–µ–Ω–∏–µ / –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ.
‚Ä¢ –£—á–∏—Ç—ã–≤–∞–π —Å–ø—Ä–æ—Å, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, –∫–ª–∏–º–∞—Ç, –≥–µ–æ–ø–æ–ª–∏—Ç–∏–∫—É, —Ç–æ—Ä–≥–æ–≤–ª—é –∏ –ª–æ–≥–∏—Å—Ç–∏–∫—É.

3. üíº –í—ã–≤–æ–¥ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
‚Ä¢ –î–∞–π –∫—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞ (–ø–æ–∫—É–ø–∞—Ç—å / –∂–¥–∞—Ç—å / –≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –ø–µ—Ä–µ–±–æ—è–º).
‚Ä¢ –û—Ç–º–µ—Ç—å —Å–≤—è–∑–∏ –º–µ–∂–¥—É –Ω–æ–≤–æ—Å—Ç—è–º–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å.

üéØ –°—Ç—Ä–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π —à–∞–±–ª–æ–Ω:

üìå –ù–æ–≤–æ—Å—Ç–∏ (–∫—Ä–∞—Ç–∫–æ):
- [–¥–∞—Ç–∞] –§–∞–∫—Ç. üîó –°—Å—ã–ª–∫–∞
- ...

üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞:
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ: [—Ä–æ—Å—Ç / –ø–∞–¥–µ–Ω–∏–µ / –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ]
- –ü—Ä–∏—á–∏–Ω—ã: ...

üíº –í—ã–≤–æ–¥ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞:
...

–í–æ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏:

{news_text}
"""

    response = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": prompt}],
        temperature=0.3,
    )
    return response.choices[0].message.content